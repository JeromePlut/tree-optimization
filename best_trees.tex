\documentclass{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[margin=20mm]{geometry}
\usepackage{math}
\usepackage{unicode}

\def\pcost{ν_\mathrm{p}}
\def\scost{ν_\mathrm{c}}
\def\treefrom#1{\left\{#1\right\}}
\newcounter{proofcase}
\newenvironment{proofcases}{\setcounter{proofcase}{0}%
	\def\item{\stepcounter{proofcase}\medskip
	(\roman{proofcase})~}}{}
\def\gcost{ν}
	

\DeclareMathOperator\Exp{Exp} % Polya exponential
\begin{document}

% \section{Optimal trees}
% 
% \begin{df}
% Let~$\ro T(n)$ be the set of all non-planar trees
% with $n$ leaves such that no node has a single child.
% \end{df}
% 
% We use the following syntax for trees: $L$ is the tree with only one
% leaf, and given trees $t_1, …, t_n$, we write $\treefrom{t_1, …, t_n}$
% for the tree where $(t_i)$ are the branches of the root node.
% Note that, since our trees are non-planar, this tree
% does not depend on the ordering of the trees~$t_i$.
% 
% \subsection{Optimal trees}
% 
% For any tree~$t ∈ \ro t(n)$, we define
% \begin{enumerate}
% \item the \emph{parent cost} of~$t$:
% $\pcost(L) = 0$, $\pcost(\treefrom{t_1, …, t_k}) = ∑ \pcost(t_i) + n$.
% \item the \emph{sibling cost} of~$t$:
% $\scost(L) = 0$, $\scost(\treefrom{t_1, …, t_k}) = ∑ \scost(t_i) + (k-1) n$.
% \item the \emph{geometric cost} of~$t$
% as the point~$\gcost(t) = (\pcost(t), \scost(t)) ∈ ℝ^2$.
% \end{enumerate}
% In particular, if $t$~is a binary tree
% then $\scost(L) = \pcost(L)$.
% 
% For any tree~$t$,
% the \emph{cost function} associated to~$t$
% is the affine map~$f_t: λ ↦ λ \pcost(t) + \scost(t)$.
% For any set~$T$ of trees,
% we define~$f_T(λ) = \inf \acco{f_t(λ),\; t ∈ T}$;
% as an infimum of affine functions, $f_T$ is a concave function.
% In fact, it is the dual of the convex hull
% of the set~$\acco{ \gcost(t),\; t ∈ T}$:
% 
% \begin{prop}
% (TODO)
% \end{prop}
% 
% 
% 
% 
% 
% \subsection{Counting trees}
% The single-child condition ensures that $\ro T(n)$~is a finite set.
% Let~$T$ be the generating series
% $T(z) = ∑ \abs{\ro T(n)}\: z^n$;
% then $T$~satisfies the functional equation
% \begin{align}
% T(z) = x + \Exp(T)(z) - T(z) - 1,
% \end{align}
% where $\Exp(T)$ is the Polya exponential, defined by
% $\Exp(f)(z) = ∑_{n≥0} f(x^n)/n$.
% 
% (TODO)
% 
% 
% \subsection{Cost functions for some families of trees}
% 
% In this section we study a few given families of trees,
% parametrized by their number of leaves~$n$;
% empirically, these are the optimal families for~$λ$ small.
% While it is possible to check this for small~$n$,
% the exponential growth of the number of trees
% (see previous section)
% prevents this exploration from going beyond, say, $n = 25$.
% We believe it reasonable to conjecture that
% these families remain optimal in the given domains
% among all trees for all values of~$n$.


\subsubsection{Tree-like integration and derivation}

Let~$d ≥ 2$ be an integer.
For any function~$f: ℕ → ℝ$ we define the
\emph{tree-like derivative} of~$f$ by
\begin{align}\ref{eq:def-D}
\ro D(f)(n) &= f(n) - ∑_{i=0:d-1} f\pa{\ceil{\frac{n+i}{d}}}.
\end{align}
One easily checks that $\ro D(f)(0) =\ro D(f)(1) = (1-d) f(0)$.
We also define the \emph{tree-like integral}
of any function~$f$ such that~$f(1) = f(0)$ by
\begin{align}\ref{eq:def-I}
\ro I(f)(n) &= \begin{cases}
\frac{1}{1-d}f(0)  & \text{for~$n = 0$ or~$n = 1$},\\
\displaystyle f(n) + ∑_{i=0:d-1} \ro I_d(f)\pa{\ceil{\frac{n+i}{d}}}
	& \text{for $n ≥ 2$.}
\end{cases}
\end{align}
When the degree~$d$ is not obvious we shall write it as a subscript,
thus $\ro D_d$, $\ro I_d$.

The operator~$\ro I$ is a right inverse of~$\ro D$;
that is, $\ro D ∘ \ro I$ is the identity
on functions such that~$f(0) = f(1)$.
In fact, $\ro D$ and~$\ro I$ are inverse bijections
on the space of such functions.

Moreover, one easily checks the following equalities:
$\ro D(n↦1) = 1-d$; $\ro D(n→n) = 0$;
$\ro I(J)$, where $J(0) = 1$ and~$J(n) = n$ for~$n ≥ 1$,
is (the restriction to the integers of)
the (continuous) piecewise affine function defined on~$[d^e, d^{e+1}]$
by~$f(x) = e x - \frac{d^e}{d-1}$.


\begin{prop}\ref{eq:calcul-I}
Let~$(y_i)$ be a sequence of real numbers
such that~$y_0 = y_1$ and~$y_i = 0$ for~$i ≥ d^c$.
Let~$f$ be the unique function interpolating~$(y_i)$
which is affine on each interval~$[i, i+1]$,
with the additional condition that~$f(d^c) = d f(d^{c-1})$.
Then, for any integer~$n ∈ [d^{c+e}, d^{c+e+1}]$,
$\ro I(y)(n) = d^e f(n/d^e)$.
\end{prop}

\begin{proof}
We prove this by induction on~$e$; the case~$e = 0$ is obvious.
Let~$n ∈ [d^{c+e+1}, d^{c+e+2}]$
and write~$n = a d + b$ be the Euclidan division of~$n$ by~$d$;
then, by definition,
\begin{align}
\ro I(y)(n) &= y(n) + ∑ \ro I(y)\pa{\floor{\frac{y+i}{d}}}\\
&= 0 + (d-b) \ro I(y)(a) + b \ro I(y)(a+1)\\
&= d^e \pa{(d-b) f\pa{\frac{a}{d^e}} + b f\pa{\frac{a+1}{d^e}}}.
\end{align}
Since $f$~is affine on the interval~$\cro{\frac{a}{d^e},
\frac{a+1}{d^e}}$, the last value is also equal
to $f\pa{a+b/d}{d^e}$.
\end{proof}


We check that $\ro I_d(J) = E_d$.

\begin{prop}\label{prop:IU}
Define~$f_d(x) = \frac{d-2}{d-1}-x$ for~$x ≤ 2$
and~$f_d(x) = \frac{-d}{d-1}$ for~$x ≥ 2$.
Then, for any integer~$n ≥ 1$, if~$e = \floor{\log_d(n)}$,
$\ro I_d(J)(n) = d^e f_d(n/d^e)$.
\end{prop}



Let~$(d_n)$ be a sequence of integers such that~$d_0 = d_1 = 0$.
The \emph{regular family of trees} with degrees~$(d_n)$
is the family of trees~$(T(n))$ with $n$ leaves
such that, for~$n ≥ 2$,
$T(n) = \acco{T\pa{\floor{\frac{n+i}{d(n)}}},\, i=0…d(n)-1}$.

\begin{prop}
Let~$d$ be an integer and define the family of trees~$T_d$
as the regular family of trees with degree~$\min(n,d)$ for~$n ≥ 2$.
Then the parent cost of~$T_d(n)$ is
\begin{align}
\pcost(T_d(n)) = E_d(n) - f_d(n) &= \begin{cases}
(e+2) n - 2 d^e & \text{for~$n ∈ [d^e, 2 d^e]$,}\\
(e+1) n & \text{for~$n ∈ [2 d^e, d^{e+1}]$.}
\end{cases}
\end{align}
\end{prop}

\begin{proof}
We easily check that $\ro D_d(\pcost(T_d)) = J - U$.
\end{proof}


\begin{prop}
Let~$T_{2,3}$ be the regular family of trees
with degree $d_2 = 2$, $d_3 = 3$ and~$d_n = 2$ for~$n ≥ 4$. Then:
\begin{align}
\pcost(T_{2,3}(n)) &= \begin{cases}
e n & \text{for $n ∈ [2^e, \frac{3}{2} ⋅ 2^e]$,}\\
(e+4) n - 6 ⋅ 2^e & \text{for $n ∈ [\frac{3}{2}⋅2^e, 2^{e+1}]$.}
\end{cases}
\end{align}
\end{prop}

% \subsubsection{Binary trees $T_2(n)$}
% 
% We define the family of \emph{binary trees}~$T_2(n)$ by
% $T_2(1) = L$ and $T_2(n) = \treefrom{T_2(\floor{n/2}),
% T_2(\ceil{n/2})}$ for~$n ≥ 2$;
% 
% \begin{prop}\label{prop:cost-T2}
% For any integer~$n$, let~$b = \floor{\log_2(n)}$. Then
% $\pcost(T_{2}(n)) = \scost(T_2(n)) = (b+2)⋅n - 2^{b+1}$;
% \end{prop}
% 
% 
% \begin{proof}
% First note that, since $T_2(n)$ is binary,
% $\scost(T_2(n)) = \pcost(T_2(n))$.
% 
% On the other hand, using the notations from~(\ref{eq:def-D}),
% we see that $\ro D(\pcost(T_2) - J)$ is $
% 
% 
% We prove the result for~$\pcost(T_2(n))$ by induction.
% If $n = 2 n'$ is even then $b' = \floor{\log_2(n')} = b-1$,
% so that $\pcost(T_2(n)) = n + 2 \pcost(T_2(n'))
%  = n + 2 (b+1)(n/2) - 2⋅ 2^b = (b+2) n - 2^{b+1}$ as required.
% In the case where~$n = 2^{b+1}-1$,
% one has $n = 2n'+1$ with $n' = 2^{b}-1$,
% so that $\floor{\log_2(n')} = b-1$
% while $\floor{\log_2(n'+1)} = b$;
% we check that $n + \pcost(T_2(n')) + \pcost(T_2(n'+1))
% %  = (2⋅2^b - 1) + (b+1)(2^b-1) - 2^b + (b+2) 2^b - 2⋅2^b
% %  = (2+b+1-1+b+2-2) 2^b -1-b-1
%  = (2b+2) 2^b - (b+2)
%  = (b+2)⋅n-2^{b+2}$ as expected.
% In the other cases, $b' = \floor{\log_2(n')} = \floor{\log_2(n'+1)} = b-1$;
% the proof is then similar.
% \end{proof}
% 
% \subsubsection{Binary-ternary trees $T_{23}(n)$}
% 
% We define the family of \emph{binary-ternary trees}~$T_2(n)$ by
% $T_{23}(1) = L$,
% $T_{23}(3⋅2^k) = \treefrom{T_{23}(2^k), T_{23}(2^k), T_{23}(2^k)}$,
% and $T_{23}(n) = \treefrom{T_{23}(\floor{n/2}), T_{23}(\ceil{n/2})}$
% otherwise.
% 
% In particular, one easily checks that $T_{23}(n) = T_2(n)$
% whenever $n$~is a power of two.
% 
% \begin{prop}\label{prop:cost-T23}
% Let~$n$ be an integer, $b = \floor{\log_2(n)}$,
% and $x = n/2^{b+1}$. Then:
% \begin{enumerate}
% \item $\pcost(T_{23}(n)) =
% \begin{cases}
% b⋅n & \text{if $1/2 ≤ x ≤ 3/4$,}\\
% (b+4)⋅n - 6⋅2^{b} & \text{if $3/4 ≤ x < 1$.}
% \end{cases}$
% \item $\scost(T_{23}(n)) =
% \begin{cases}
% (b+3)⋅n - 3⋅2^b & \text{if $1/2 ≤ x ≤ 3/4$,}\\
% (b+1)⋅n & \text{if $3/4 ≤ x < 1$.}
% \end{cases}$
% \end{enumerate}
% (Note that for cases~(ii) and~(iii), both values coincide for~$x = 3/4$).
% \end{prop}
% 
% 
% \begin{proof}
% \begin{proofcases}
% \item
% The result is easy to check by induction for~$n = 2^b$.
% The case of~$n = 3 ⋅ 2^{b-1}$ follows.
% We prove the remaining cases by induction.
% Assume that $n = 2n'$ is even,
% so that $\pcost(T_{23}(n') = n + 2 \pcost(T_{23}(n'))$;
% then one has $b' = \floor{\log_2(n')} = b-1$
% and~$x' = n'/2^{b'} = x$.
% If $x ≤ 3/4$ then $\pcost(T_{23}(n')) = b'⋅n'$,
% so that $\pcost(T_{23}(n)) = n + 2 (b-1)(n/2) = bn$.
% If $x > 3/4$ then $\pcost(T_{23}(n')) = (b'+4)⋅n' - 6⋅2^{b'}$,
% so that $\pcost(T_{23}(n)) = n + 2((b-1)+4)(n/2) - 12⋅2^{b-1}
%  = (b+4) n - 6⋅2^{b}$.
% Finally, if $n = 2n'+1$ is odd,
% then $b' = \floor{\log_2(n')} = \floor{\log_2(n'+1)} = b-1$,
% and $n'/2^{b'}$, $(n'+1)/2^{b'}$ are $> 3/4$ exactly when $n/2^b > 3/4$.
% The result then follows in the same way.
% 
% \item
% \end{proofcases}
% \end{proof}
% 
% As a simple consequence of Props.~\ref{prop:cost-T2}
% and~\ref{prop:cost-T23} we obtain the following slope:
% 
% \begin{prop}\label{prop:slope-T2-T23}
% For any integer~$n$, with the same notations as in
% Prop.~\ref{prop:cost-T23}:
% \begin{align}
% \gcost(T_{23}(n)) - \gcost(T_{2}(n)) &=
% \begin{cases}
% \rlap{$(n - 2^b)$}\hphantom{(2^{b+1}-n\;\;} (-2,1) & \text{if $x≤ 3/4$},\\
% (2^{b+1} - n) (-2,1) & \text{if $x ≥ 3/4$}.
% \end{cases}
% \end{align}
% In particular, the segment~$(\gcost(T_2(n)), \gcost(T_{23}(n)))$
% is either degenerate (when $n$~is a power of~two)
% or has slope~$-\frac 12$.
% \end{prop}
% 
% \subsubsection{Ternary-binary trees $T_{32}(n)$}
% 
% The tree family $T_{32}(n)$ is defined in the following way:
% \begin{align}
% T_{32}(n) &= \begin{cases}
% \treefrom{T_{32}(\floor{n/2}), T_{32}(\floor{(n+1)/2})}
% 	&\text{if $6⋅2^b < n < 9⋅2^b$ for some integer~$b$,}\\
% \treefrom{T_{32}(\floor{n/3}), T_{32}(\floor{(n+1)/3}),
% 	T_{32}(\floor{(n+2)/3})}
% 	&\text{if $9⋅2^b ≤ n ≤ 6⋅2^b$}.
% \end{cases}
% \end{align}
% 
% \subsubsection{(Almost) Ternary trees $T_3(n)$}
% 
% Since ternary trees always have an odd number of leaves,
% the trees $T_3(n)$ are not always ternary.
% They are defined by $T_3(1) = L$,
% $T_3(2) = \treefrom{L,L}$,
% $T_3(4) = \treefrom{T_3(2), T_3(2)}$,
% $T_3(5) = \treefrom{T_3(3), T_3(2)}$,
% and otherwise $T_3(n) = \treefrom{T_3(\floor{n/3}),
% 	T_3(\floor{(n+1)/3}), T_3(\floor{(n+2)/3})}$.
% 
% \begin{prop}
% Let~$n$ be an integer, $b = \floor{\log_3(n)}$,
% and $x = n/3^{b+1}$. Then:
% \begin{enumerate}
% \item $\pcost(T_{3}(n)) =
% \begin{cases}
% (b+4)⋅n - 4⋅3^{b} & \text{if $1/3 ≤ x ≤ 4/9$,}\\
% (b+1)⋅n & \text{if $4/9 ≤ x < 1$.}
% \end{cases}$
% % \item $\scost(T_{3}(n)) =
% % \begin{cases}
% % (b+3)⋅n - 3⋅2^b & \text{if $1/2 ≤ x ≤ 3/4$,}\\
% % (b+1)⋅n & \text{if $3/4 ≤ x < 1$.}
% % \end{cases}$
% \end{enumerate}
% (Note that for cases~(ii) and~(iii), both values coincide for~$x = 3/4$).
% \end{prop}
% 
% 

\end{document}
